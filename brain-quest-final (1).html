<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brain Quest - ëì—†ëŠ” ë„ì „! ğŸ§ </title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 10px;
            user-select: none;
        }

        .container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        /* í—¤ë” */
        .header {
            text-align: center;
            padding: 15px 0;
            border-bottom: 2px solid #f0f0f0;
        }

        h1 {
            font-size: 1.8em;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 5px;
        }

        .tagline {
            color: #666;
            font-size: 0.9em;
        }

        /* ìƒë‹¨ ë°” */
        .top-bar {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 15px;
            margin: 15px 0;
        }

        .stat-box {
            text-align: center;
            padding: 10px;
            background: white;
            border-radius: 10px;
        }

        .stat-icon {
            font-size: 1.5em;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.3em;
            font-weight: bold;
            color: #667eea;
        }

        .stat-label {
            font-size: 0.75em;
            color: #666;
            margin-top: 3px;
        }

        /* ì—ë„ˆì§€ ë°” */
        .energy-bar {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            color: white;
            position: relative;
        }

        .energy-hearts {
            display: flex;
            justify-content: center;
            gap: 10px;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .heart {
            transition: all 0.3s;
        }

        .heart.empty {
            opacity: 0.3;
        }

        .energy-text {
            text-align: center;
            font-size: 0.9em;
        }

        .energy-timer {
            font-weight: bold;
            font-size: 1.1em;
        }

        .energy-btn {
            background: white;
            color: #e74c3c;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: bold;
            margin-top: 10px;
            width: 100%;
            cursor: pointer;
            font-size: 1em;
        }

        /* ë ˆë²¨ í‘œì‹œ */
        .level-display {
            text-align: center;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 15px;
            color: white;
            margin: 15px 0;
        }

        .level-number {
            font-size: 3em;
            font-weight: bold;
            margin-bottom: 5px;
        }

        .level-label {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .difficulty-badge {
            display: inline-block;
            background: rgba(255,255,255,0.2);
            padding: 5px 15px;
            border-radius: 15px;
            margin-top: 10px;
            font-size: 0.9em;
        }

        /* ì§„í–‰ë„ ë°” */
        .progress-section {
            padding: 15px;
            background: #f8f9fa;
            border-radius: 12px;
            margin: 15px 0;
        }

        .progress-label {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
            font-size: 0.9em;
            color: #666;
        }

        .progress-bar-bg {
            background: #e0e0e0;
            height: 25px;
            border-radius: 15px;
            overflow: hidden;
            position: relative;
        }

        .progress-bar-fill {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            height: 100%;
            transition: width 0.5s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 0.85em;
        }

        /* ë©”ì¸ í™”ë©´ */
        .main-screen {
            display: block;
        }

        .play-btn {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 20px;
            border-radius: 15px;
            font-size: 1.5em;
            font-weight: bold;
            cursor: pointer;
            width: 100%;
            margin: 20px 0;
            box-shadow: 0 5px 20px rgba(76, 175, 80, 0.4);
            transition: all 0.3s;
        }

        .play-btn:active {
            transform: translateY(3px);
        }

        .play-btn:disabled {
            background: #95a5a6;
            cursor: not-allowed;
            box-shadow: none;
        }

        /* ë¶€ìŠ¤í„° ì„¹ì…˜ */
        .boosters-section {
            padding: 15px;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            border-radius: 12px;
            margin: 15px 0;
        }

        .boosters-title {
            font-size: 1.1em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
            text-align: center;
        }

        .boosters-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .booster-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.3s;
        }

        .booster-card:active {
            transform: scale(0.95);
        }

        .booster-card.active {
            border-color: #4caf50;
            box-shadow: 0 0 15px rgba(76, 175, 80, 0.3);
        }

        .booster-icon {
            font-size: 2.5em;
            margin-bottom: 5px;
        }

        .booster-name {
            font-weight: bold;
            font-size: 0.9em;
            color: #333;
            margin-bottom: 5px;
        }

        .booster-count {
            font-size: 0.85em;
            color: #666;
        }

        .booster-price {
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            color: white;
            padding: 5px 10px;
            border-radius: 8px;
            font-size: 0.85em;
            font-weight: bold;
            margin-top: 5px;
            display: inline-block;
        }

        /* ê²Œì„ í™”ë©´ */
        .game-screen {
            display: none;
        }

        .game-header {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 10px;
            align-items: center;
            margin-bottom: 15px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 10px;
        }

        .game-info {
            font-size: 0.9em;
            color: #666;
            text-align: center;
        }

        .game-timer {
            background: #e74c3c;
            color: white;
            padding: 8px 15px;
            border-radius: 8px;
            font-weight: bold;
            font-size: 1.1em;
        }

        .game-area {
            background: #f8f9fa;
            padding: 30px 20px;
            border-radius: 15px;
            min-height: 350px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            margin-bottom: 15px;
        }

        .question {
            font-size: 1.6em;
            font-weight: bold;
            color: #333;
            margin-bottom: 25px;
            text-align: center;
            line-height: 1.4;
        }

        .options {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 12px;
            width: 100%;
            max-width: 400px;
        }

        .option-btn {
            background: white;
            border: 3px solid #667eea;
            padding: 18px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            color: #667eea;
            cursor: pointer;
            transition: all 0.3s;
            min-height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .option-btn:active {
            transform: scale(0.95);
        }

        .option-btn.correct {
            background: #4caf50;
            border-color: #4caf50;
            color: white;
            animation: correctPulse 0.5s;
        }

        .option-btn.wrong {
            background: #e74c3c;
            border-color: #e74c3c;
            color: white;
            animation: wrongShake 0.5s;
        }

        @keyframes correctPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }

        @keyframes wrongShake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-10px); }
            75% { transform: translateX(10px); }
        }

        /* ê²°ê³¼ ëª¨ë‹¬ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
            animation: fadeIn 0.3s;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 20px;
            max-width: 400px;
            width: 90%;
            text-align: center;
            animation: slideUp 0.3s;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .result-icon {
            font-size: 5em;
            margin-bottom: 15px;
        }

        .result-title {
            font-size: 2em;
            font-weight: bold;
            color: #333;
            margin-bottom: 10px;
        }

        .result-message {
            font-size: 1.1em;
            color: #666;
            margin: 15px 0;
        }

        .reward-box {
            background: linear-gradient(135deg, #ffd93d 0%, #f9ca24 100%);
            padding: 15px;
            border-radius: 12px;
            margin: 15px 0;
            color: white;
        }

        .reward-text {
            font-size: 1.3em;
            font-weight: bold;
        }

        .modal-buttons {
            display: grid;
            gap: 10px;
            margin-top: 20px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-success {
            background: linear-gradient(135deg, #4caf50 0%, #45a049 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-warning {
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1.1em;
            font-weight: bold;
            cursor: pointer;
        }

        .btn-secondary {
            background: #95a5a6;
            color: white;
            border: none;
            padding: 15px;
            border-radius: 12px;
            font-size: 1em;
            cursor: pointer;
        }

        /* ê´‘ê³  í”Œë ˆì´ìŠ¤í™€ë” */
        .ad-placeholder {
            background: linear-gradient(135deg, #ecf0f1 0%, #bdc3c7 100%);
            padding: 20px;
            text-align: center;
            border-radius: 12px;
            margin: 15px 0;
            border: 2px dashed #95a5a6;
        }

        .ad-text {
            color: #7f8c8d;
            font-size: 0.9em;
        }

        /* ìƒì  */
        .shop-screen {
            display: none;
        }

        .shop-section {
            margin: 20px 0;
        }

        .shop-title {
            font-size: 1.3em;
            font-weight: bold;
            color: #333;
            margin-bottom: 15px;
        }

        .shop-items {
            display: grid;
            gap: 10px;
        }

        .shop-item {
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            padding: 15px;
            border-radius: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .shop-item-info {
            flex: 1;
        }

        .shop-item-icon {
            font-size: 2em;
            margin-bottom: 5px;
        }

        .shop-item-name {
            font-weight: bold;
            font-size: 1.1em;
            color: #333;
            margin-bottom: 3px;
        }

        .shop-item-desc {
            font-size: 0.85em;
            color: #666;
        }

        .shop-item-btn {
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            color: white;
            padding: 12px 20px;
            border-radius: 10px;
            font-weight: bold;
            cursor: pointer;
            border: none;
            font-size: 1em;
        }

        /* ì•Œë¦¼ */
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 12px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            display: none;
            z-index: 2000;
            max-width: 300px;
            animation: slideInRight 0.3s;
        }

        @keyframes slideInRight {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .notification.show {
            display: block;
        }

        .notification.success { border-left: 5px solid #4caf50; }
        .notification.error { border-left: 5px solid #e74c3c; }
        .notification.info { border-left: 5px solid #3498db; }

        /* ë°˜ì‘í˜• */
        @media (max-width: 600px) {
            .options {
                grid-template-columns: 1fr;
            }
        }

        /* í”„ë¦¬ë¯¸ì—„ ë°°ë„ˆ */
        .premium-banner {
            background: linear-gradient(135deg, #f39c12 0%, #f1c40f 100%);
            padding: 15px;
            border-radius: 12px;
            text-align: center;
            color: white;
            margin: 15px 0;
            cursor: pointer;
        }

        .premium-banner h3 {
            font-size: 1.2em;
            margin-bottom: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- í—¤ë” -->
        <div class="header">
            <h1>ğŸ§  Brain Quest</h1>
            <p class="tagline">ëì—†ëŠ” ë„ì „! ë‹¹ì‹ ì€ ì–´ë””ê¹Œì§€?</p>
        </div>

        <!-- ìƒë‹¨ í†µê³„ -->
        <div class="top-bar">
            <div class="stat-box">
                <div class="stat-icon">ğŸ†</div>
                <div class="stat-value" id="currentLevel">1</div>
                <div class="stat-label">í˜„ì¬ ë ˆë²¨</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">ğŸ’</div>
                <div class="stat-value" id="coinCount">100</div>
                <div class="stat-label">ì½”ì¸</div>
            </div>
            <div class="stat-box">
                <div class="stat-icon">â­</div>
                <div class="stat-value" id="highestLevel">1</div>
                <div class="stat-label">ìµœê³  ë ˆë²¨</div>
            </div>
        </div>

        <!-- ì—ë„ˆì§€ ë°” -->
        <div class="energy-bar">
            <div class="energy-hearts" id="energyHearts">
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
                <span class="heart">â¤ï¸</span>
            </div>
            <div class="energy-text">
                <span id="energyText">ì—ë„ˆì§€ ì¶©ì „ê¹Œì§€: </span>
                <span class="energy-timer" id="energyTimer">10:00</span>
            </div>
            <button class="energy-btn" onclick="showEnergyOptions()">
                âš¡ ì—ë„ˆì§€ ì¶©ì „í•˜ê¸°
            </button>
        </div>

        <!-- ë©”ì¸ í™”ë©´ -->
        <div class="main-screen" id="mainScreen">
            <!-- ë ˆë²¨ í‘œì‹œ -->
            <div class="level-display">
                <div class="level-label">LEVEL</div>
                <div class="level-number" id="levelDisplay">1</div>
                <div class="difficulty-badge" id="difficultyBadge">ğŸŸ¢ ì‰¬ì›€</div>
            </div>

            <!-- ì§„í–‰ë„ -->
            <div class="progress-section">
                <div class="progress-label">
                    <span>ì´ë²ˆ êµ¬ê°„ ì§„í–‰ë„</span>
                    <span id="progressText">1/10</span>
                </div>
                <div class="progress-bar-bg">
                    <div class="progress-bar-fill" id="progressFill" style="width: 10%">10%</div>
                </div>
            </div>

            <!-- ë¶€ìŠ¤í„° -->
            <div class="boosters-section">
                <div class="boosters-title">ğŸ ë¶€ìŠ¤í„° ì‚¬ìš©</div>
                <div class="boosters-grid">
                    <div class="booster-card" onclick="selectBooster('time')">
                        <div class="booster-icon">â°</div>
                        <div class="booster-name">ì‹œê°„ ì¶”ê°€</div>
                        <div class="booster-count">ë³´ìœ : <span id="timeCount">3</span></div>
                        <div class="booster-price">30ğŸ’</div>
                    </div>
                    <div class="booster-card" onclick="selectBooster('hint')">
                        <div class="booster-icon">ğŸ’¡</div>
                        <div class="booster-name">íŒíŠ¸</div>
                        <div class="booster-count">ë³´ìœ : <span id="hintCount">5</span></div>
                        <div class="booster-price">20ğŸ’</div>
                    </div>
                    <div class="booster-card" onclick="selectBooster('bomb')">
                        <div class="booster-icon">ğŸ’£</div>
                        <div class="booster-name">ì˜¤ë‹µ ì œê±°</div>
                        <div class="booster-count">ë³´ìœ : <span id="bombCount">2</span></div>
                        <div class="booster-price">50ğŸ’</div>
                    </div>
                    <div class="booster-card" onclick="selectBooster('freeze')">
                        <div class="booster-icon">â„ï¸</div>
                        <div class="booster-name">ì‹œê°„ ì •ì§€</div>
                        <div class="booster-count">ë³´ìœ : <span id="freezeCount">1</span></div>
                        <div class="booster-price">80ğŸ’</div>
                    </div>
                </div>
            </div>

            <!-- í”Œë ˆì´ ë²„íŠ¼ -->
            <button class="play-btn" id="playBtn" onclick="startLevel()">
                ğŸš€ ë„ì „ ì‹œì‘!
            </button>

            <!-- í”„ë¦¬ë¯¸ì—„ ë°°ë„ˆ -->
            <div class="premium-banner" onclick="showShop()">
                <h3>â­ í”„ë¦¬ë¯¸ì—„ íšŒì›</h3>
                <p>ë¬´ì œí•œ ì—ë„ˆì§€ + ê´‘ê³  ì œê±°</p>
                <p style="font-size: 1.3em; margin-top: 5px;">$4.99/ì›”</p>
            </div>

            <!-- ë²„íŠ¼ë“¤ -->
            <button class="btn-secondary" onclick="showShop()" style="width: 100%; margin: 10px 0;">
                ğŸ›’ ìƒì 
            </button>

            <!-- ê´‘ê³  -->
            <div class="ad-placeholder">
                <p class="ad-text">ğŸ“º ë°°ë„ˆ ê´‘ê³ </p>
            </div>
        </div>

        <!-- ê²Œì„ í™”ë©´ -->
        <div class="game-screen" id="gameScreen">
            <div class="game-header">
                <button class="btn-secondary" onclick="backToMain()" style="padding: 8px 15px; width: auto;">â† ë©”ì¸ìœ¼ë¡œ</button>
                <div class="game-info">
                    ë ˆë²¨ <span id="gameLevelNum">1</span>
                </div>
                <div class="game-timer" id="gameTimer">30</div>
            </div>

            <div class="game-area" id="gameArea">
                <!-- ê²Œì„ ë‚´ìš© -->
            </div>
        </div>

        <!-- ìƒì  í™”ë©´ -->
        <div class="shop-screen" id="shopScreen">
            <div class="game-header">
                <button class="btn-secondary" onclick="closeShop()">â† ë’¤ë¡œ</button>
                <div style="font-size: 1.3em; font-weight: bold;">ğŸ›’ ìƒì </div>
                <div></div>
            </div>

            <div class="shop-section">
                <div class="shop-title">âš¡ ì—ë„ˆì§€</div>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">â¤ï¸</div>
                            <div class="shop-item-name">ì—ë„ˆì§€ 5ê°œ</div>
                            <div class="shop-item-desc">ì¦‰ì‹œ ì¶©ì „</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyItem('energy5', 50)">
                            50ğŸ’
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">âš¡</div>
                            <div class="shop-item-name">ë¬´ì œí•œ 1ì‹œê°„</div>
                            <div class="shop-item-desc">ì‹¤ì œ ê²°ì œ</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyWithMoney('unlimited1h', 1.99)">
                            $1.99
                        </button>
                    </div>
                </div>
            </div>

            <div class="shop-section">
                <div class="shop-title">ğŸ’ ì½”ì¸</div>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">ğŸ’</div>
                            <div class="shop-item-name">100 ì½”ì¸</div>
                            <div class="shop-item-desc">ì‹¤ì œ ê²°ì œ</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyWithMoney('coins100', 0.99)">
                            $0.99
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">ğŸ’</div>
                            <div class="shop-item-name">500 ì½”ì¸</div>
                            <div class="shop-item-desc">30% ë³´ë„ˆìŠ¤!</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyWithMoney('coins500', 3.99)">
                            $3.99
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">ğŸ’</div>
                            <div class="shop-item-name">1500 ì½”ì¸</div>
                            <div class="shop-item-desc">50% ë³´ë„ˆìŠ¤!</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyWithMoney('coins1500', 9.99)">
                            $9.99
                        </button>
                    </div>
                </div>
            </div>

            <div class="shop-section">
                <div class="shop-title">ğŸ ë¶€ìŠ¤í„°</div>
                <div class="shop-items">
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">â°</div>
                            <div class="shop-item-name">ì‹œê°„ ì¶”ê°€ 5ê°œ</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyItem('time5', 100)">
                            100ğŸ’
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">ğŸ’¡</div>
                            <div class="shop-item-name">íŒíŠ¸ 10ê°œ</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyItem('hint10', 150)">
                            150ğŸ’
                        </button>
                    </div>
                    <div class="shop-item">
                        <div class="shop-item-info">
                            <div class="shop-item-icon">ğŸ’£</div>
                            <div class="shop-item-name">ì˜¤ë‹µì œê±° 5ê°œ</div>
                        </div>
                        <button class="shop-item-btn" onclick="buyItem('bomb5', 200)">
                            200ğŸ’
                        </button>
                    </div>
                </div>
            </div>

            <div class="shop-section">
                <div class="premium-banner" onclick="buyPremium()">
                    <h3>â­ í”„ë¦¬ë¯¸ì—„ ë©¤ë²„ì‹­</h3>
                    <p style="margin: 10px 0;">âœ“ ë¬´ì œí•œ ì—ë„ˆì§€</p>
                    <p>âœ“ ëª¨ë“  ê´‘ê³  ì œê±°</p>
                    <p>âœ“ ë…ì  ë¶€ìŠ¤í„°</p>
                    <p>âœ“ ë§¤ì¼ ì½”ì¸ 100ê°œ</p>
                    <p style="font-size: 1.5em; margin-top: 10px;">$4.99/ì›”</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ê²°ê³¼ ëª¨ë‹¬ -->
    <div class="modal" id="resultModal">
        <div class="modal-content">
            <div class="result-icon" id="resultIcon">ğŸ‰</div>
            <div class="result-title" id="resultTitle">ì„±ê³µ!</div>
            <div class="result-message" id="resultMessage">ë ˆë²¨ í´ë¦¬ì–´!</div>
            <div class="reward-box" id="rewardBox">
                <div class="reward-text" id="rewardText">+10 ğŸ’</div>
            </div>
            <div class="ad-placeholder" style="margin: 20px 0;">
                <p class="ad-text">ğŸ“º ì „ë©´ ê´‘ê³ </p>
            </div>
            <div class="modal-buttons">
                <button class="btn-success" id="continueBtn" onclick="nextLevel()">
                    â¡ï¸ ë‹¤ìŒ ë ˆë²¨
                </button>
            </div>
        </div>
    </div>

    <!-- ì‹¤íŒ¨ ëª¨ë‹¬ -->
    <div class="modal" id="failModal">
        <div class="modal-content">
            <div class="result-icon">ğŸ˜¢</div>
            <div class="result-title">ì‹¤íŒ¨...</div>
            <div class="result-message" id="failMessage">ì•„ì‰½ê²Œë„ í‹€ë ¸ìŠµë‹ˆë‹¤</div>
            <div class="modal-buttons">
                <button class="btn-warning" onclick="watchAdToContinue()">
                    ğŸ“º ê´‘ê³  ë³´ê³  ì¬ë„ì „ (ë¬´ë£Œ)
                </button>
                <button class="btn-success" onclick="useEnergyToRetry()">
                    â¤ï¸ ì—ë„ˆì§€ ì‚¬ìš©í•˜ê³  ì¬ë„ì „
                </button>
                <button class="btn-secondary" onclick="closeFailModal()">
                    ë©”ë‰´ë¡œ ëŒì•„ê°€ê¸°
                </button>
            </div>
        </div>
    </div>

    <!-- ì—ë„ˆì§€ ë¶€ì¡± ëª¨ë‹¬ -->
    <div class="modal" id="noEnergyModal">
        <div class="modal-content">
            <div class="result-icon">ğŸ’”</div>
            <div class="result-title">ì—ë„ˆì§€ ë¶€ì¡±</div>
            <div class="result-message">
                ì—ë„ˆì§€ê°€ ëª¨ë‘ ì†Œì§„ë˜ì—ˆìŠµë‹ˆë‹¤<br>
                <span id="waitTime" style="color: #e74c3c; font-weight: bold;">10:00</span> í›„ ì¶©ì „ë©ë‹ˆë‹¤
            </div>
            <div class="modal-buttons">
                <button class="btn-warning" onclick="watchAdForEnergy()">
                    ğŸ“º ê´‘ê³  ë³´ê³  1ê°œ ë°›ê¸°
                </button>
                <button class="btn-success" onclick="buyEnergyFromModal()">
                    ğŸ’ ì½”ì¸ìœ¼ë¡œ êµ¬ë§¤ (50ğŸ’ = 5â¤ï¸)
                </button>
                <button class="btn-primary" onclick="buyWithMoney('unlimited1h', 1.99)">
                    ğŸ’³ ë¬´ì œí•œ 1ì‹œê°„ ($1.99)
                </button>
                <button class="btn-secondary" onclick="closeNoEnergyModal()">
                    ë‚˜ì¤‘ì—
                </button>
            </div>
        </div>
    </div>

    <!-- ì•Œë¦¼ -->
    <div class="notification" id="notification">
        <p id="notificationText"></p>
    </div>

    <script>
        // ê²Œì„ ë°ì´í„°
        let gameData = {
            currentLevel: 1,
            highestLevel: 1,
            coins: 5,
            energy: 5,
            maxEnergy: 5,
            isPremium: false,
            boosters: {
                time: 3,
                hint: 5,
                bomb: 2,
                freeze: 1
            },
            lastEnergyTime: Date.now()
        };

        // ê²Œì„ ìƒíƒœ
        let gameTimer = null;
        let timeLeft = 30;
        let energyTimer = null;
        let selectedBooster = null;
        let currentQuestion = null;

        // ë‚œì´ë„ ì„¤ì •
        function getDifficulty(level) {
            if (level <= 10) return { name: 'ğŸŸ¢ ì‰¬ì›€', time: 30, range: 20 };
            if (level <= 30) return { name: 'ğŸŸ¡ ë³´í†µ', time: 25, range: 50 };
            if (level <= 60) return { name: 'ğŸŸ  ì–´ë ¤ì›€', time: 20, range: 100 };
            if (level <= 100) return { name: 'ğŸ”´ ë§¤ìš° ì–´ë ¤ì›€', time: 15, range: 200 };
            return { name: 'ğŸŸ£ ì§€ì˜¥', time: 12, range: 500 };
        }

        // ë°ì´í„° ë¡œë“œ
        function loadData() {
            const saved = localStorage.getItem('brainQuestData');
            if (saved) {
                gameData = JSON.parse(saved);
            }
            updateUI();
            startEnergyTimer();
        }

        // ë°ì´í„° ì €ì¥
        function saveData() {
            localStorage.setItem('brainQuestData', JSON.stringify(gameData));
        }

        // UI ì—…ë°ì´íŠ¸
        function updateUI() {
            document.getElementById('currentLevel').textContent = gameData.currentLevel;
            document.getElementById('highestLevel').textContent = gameData.highestLevel;
            document.getElementById('coinCount').textContent = gameData.coins;
            document.getElementById('levelDisplay').textContent = gameData.currentLevel;
            document.getElementById('gameLevelNum').textContent = gameData.currentLevel;
            
            // ë‚œì´ë„ í‘œì‹œ
            const diff = getDifficulty(gameData.currentLevel);
            document.getElementById('difficultyBadge').textContent = diff.name;
            
            // ì§„í–‰ë„
            const progress = ((gameData.currentLevel - 1) % 10) + 1;
            const progressPercent = progress * 10;
            document.getElementById('progressText').textContent = `${progress}/10`;
            document.getElementById('progressFill').style.width = progressPercent + '%';
            document.getElementById('progressFill').textContent = progressPercent + '%';
            
            // ì—ë„ˆì§€
            updateEnergyDisplay();
            
            // ë¶€ìŠ¤í„°
            document.getElementById('timeCount').textContent = gameData.boosters.time;
            document.getElementById('hintCount').textContent = gameData.boosters.hint;
            document.getElementById('bombCount').textContent = gameData.boosters.bomb;
            document.getElementById('freezeCount').textContent = gameData.boosters.freeze;
            
            // í”Œë ˆì´ ë²„íŠ¼
            const playBtn = document.getElementById('playBtn');
            if (gameData.energy <= 0 && !gameData.isPremium) {
                playBtn.disabled = true;
                playBtn.textContent = 'â¤ï¸ ì—ë„ˆì§€ ë¶€ì¡±!';
            } else {
                playBtn.disabled = false;
                playBtn.textContent = 'ğŸš€ ë„ì „ ì‹œì‘!';
            }
        }

        // ì—ë„ˆì§€ í‘œì‹œ
        function updateEnergyDisplay() {
            const hearts = document.querySelectorAll('.heart');
            hearts.forEach((heart, i) => {
                if (i < gameData.energy) {
                    heart.classList.remove('empty');
                } else {
                    heart.classList.add('empty');
                }
            });
        }

        // ì—ë„ˆì§€ íƒ€ì´ë¨¸
        function startEnergyTimer() {
            if (energyTimer) clearInterval(energyTimer);
            
            energyTimer = setInterval(() => {
                if (gameData.energy < gameData.maxEnergy && !gameData.isPremium) {
                    const elapsed = Date.now() - gameData.lastEnergyTime;
                    const rechargeTime = 10 * 60 * 1000; // 10ë¶„
                    
                    if (elapsed >= rechargeTime) {
                        gameData.energy = Math.min(gameData.energy + 1, gameData.maxEnergy);
                        gameData.lastEnergyTime = Date.now();
                        saveData();
                        updateUI();
                        showNotification('ì—ë„ˆì§€ 1ê°œ ì¶©ì „ ì™„ë£Œ! â¤ï¸', 'success');
                    }
                    
                    // ë‚¨ì€ ì‹œê°„ í‘œì‹œ
                    const remaining = rechargeTime - (elapsed % rechargeTime);
                    const minutes = Math.floor(remaining / 60000);
                    const seconds = Math.floor((remaining % 60000) / 1000);
                    document.getElementById('energyTimer').textContent = 
                        `${minutes}:${seconds.toString().padStart(2, '0')}`;
                    document.getElementById('energyText').textContent = 
                        gameData.energy < gameData.maxEnergy ? 'ì—ë„ˆì§€ ì¶©ì „ê¹Œì§€: ' : 'ì—ë„ˆì§€ ê°€ë“! ';
                } else {
                    document.getElementById('energyTimer').textContent = '';
                    document.getElementById('energyText').textContent = 
                        gameData.isPremium ? 'â­ ë¬´ì œí•œ ì—ë„ˆì§€' : 'ì—ë„ˆì§€ ê°€ë“!';
                }
            }, 1000);
        }

        // ë ˆë²¨ ì‹œì‘
        function startLevel() {
            if (gameData.energy <= 0 && !gameData.isPremium) {
                showNoEnergyModal();
                return;
            }
            
            // ì—ë„ˆì§€ ì†Œëª¨
            if (!gameData.isPremium) {
                gameData.energy--;
                gameData.lastEnergyTime = Date.now();
                saveData();
                updateUI();
            }
            
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('gameScreen').style.display = 'block';
            
            generateQuestion();
            startGameTimer();
        }

        // ê²Œì„ íƒ€ì… ê²°ì • (ë ˆë²¨ì— ë”°ë¼ ìˆœí™˜)
        function getGameType(level) {
            const types = ['math', 'color', 'pattern', 'word', 'reaction'];
            return types[(level - 1) % 5];
        }

        // ë¬¸ì œ ìƒì„±
        function generateQuestion() {
            const diff = getDifficulty(gameData.currentLevel);
            timeLeft = diff.time;
            
            // ë¶€ìŠ¤í„° íš¨ê³¼
            if (selectedBooster === 'time') {
                timeLeft += 15;
                gameData.boosters.time--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
            
            const gameType = getGameType(gameData.currentLevel);
            
            if (gameType === 'math') {
                generateMathGame(diff);
            } else if (gameType === 'color') {
                generateColorGame(diff);
            } else if (gameType === 'pattern') {
                generatePatternGame(diff);
            } else if (gameType === 'word') {
                generateWordGame(diff);
            } else if (gameType === 'reaction') {
                generateReactionGame(diff);
            }
        }

        // 1. ìˆ«ì ê²Œì„
        function generateMathGame(diff) {
            const num1 = Math.floor(Math.random() * diff.range) + 1;
            const num2 = Math.floor(Math.random() * diff.range) + 1;
            const num3 = Math.floor(Math.random() * diff.range) + 1;
            
            const operations = [
                { text: `${num1} + ${num2}`, answer: num1 + num2 },
                { text: `${num1} Ã— ${num2}`, answer: num1 * num2 },
                { text: `${num1 + num2} - ${num3}`, answer: num1 + num2 - num3 },
                { text: `${num1} + ${num2} + ${num3}`, answer: num1 + num2 + num3 }
            ];
            
            currentQuestion = operations[Math.floor(Math.random() * operations.length)];
            const correctAnswer = currentQuestion.answer;
            
            // ì˜¤ë‹µ ìƒì„±
            let wrongAnswers = [
                correctAnswer + Math.floor(Math.random() * 10) + 1,
                correctAnswer - Math.floor(Math.random() * 10) - 1,
                correctAnswer + Math.floor(Math.random() * 20) + 10
            ];
            
            // ë¶€ìŠ¤í„°: ì˜¤ë‹µ ì œê±°
            if (selectedBooster === 'bomb') {
                wrongAnswers = [wrongAnswers[0]];
                gameData.boosters.bomb--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
            
            const answers = [correctAnswer, ...wrongAnswers].sort(() => Math.random() - 0.5);
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="question">ğŸ”¢ ${currentQuestion.text} = ?</div>
                <div class="options">
                    ${answers.map(ans => `
                        <button class="option-btn" onclick="checkAnswer(${ans === correctAnswer}, ${correctAnswer})">${ans}</button>
                    `).join('')}
                </div>
            `;
            
            // íŒíŠ¸ ë¶€ìŠ¤í„°
            if (selectedBooster === 'hint') {
                showNotification(`íŒíŠ¸: ì •ë‹µì€ ${correctAnswer}ì…ë‹ˆë‹¤!`, 'info');
                gameData.boosters.hint--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
        }

        // 2. ìƒ‰ê¹” ê¸°ì–µ ê²Œì„
        function generateColorGame(diff) {
            const colors = ['#e74c3c', '#3498db', '#2ecc71', '#f39c12', '#9b59b6', '#1abc9c'];
            const gridSize = Math.min(9, 4 + Math.floor(gameData.currentLevel / 20));
            const showCount = Math.min(Math.floor(gridSize / 3), 2 + Math.floor(gameData.currentLevel / 30));
            
            const selectedIndices = [];
            while (selectedIndices.length < showCount) {
                const idx = Math.floor(Math.random() * gridSize);
                if (!selectedIndices.includes(idx)) {
                    selectedIndices.push(idx);
                }
            }
            
            currentQuestion = { answer: selectedIndices.sort((a,b) => a-b).join(','), type: 'color', gridSize };
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="question">ğŸ¨ ìƒ‰ê¹”ì„ ê¸°ì–µí•˜ì„¸ìš”!</div>
                <div style="display: grid; grid-template-columns: repeat(3, 70px); gap: 8px;" id="colorGrid"></div>
                <button class="btn-primary" id="colorSubmit" style="display:none; margin-top: 20px;" onclick="checkColorMemory()">í™•ì¸</button>
            `;
            
            const grid = document.getElementById('colorGrid');
            window.colorSelectedCells = [];
            
            for (let i = 0; i < gridSize; i++) {
                const cell = document.createElement('div');
                cell.style.width = '70px';
                cell.style.height = '70px';
                cell.style.borderRadius = '10px';
                cell.style.cursor = 'pointer';
                cell.style.border = '3px solid transparent';
                cell.style.transition = 'all 0.3s';
                cell.dataset.index = i;
                
                if (selectedIndices.includes(i)) {
                    cell.style.background = colors[Math.floor(Math.random() * colors.length)];
                    cell.dataset.wasColored = 'true';
                } else {
                    cell.style.background = '#ddd';
                }
                
                grid.appendChild(cell);
            }
            
            // íŒíŠ¸
            if (selectedBooster === 'hint') {
                showNotification(`íŒíŠ¸: ${showCount}ê°œì˜ ìƒ‰ê¹”ì´ ìˆìŠµë‹ˆë‹¤!`, 'info');
                gameData.boosters.hint--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
            
            setTimeout(() => {
                const cells = grid.querySelectorAll('div');
                cells.forEach(cell => {
                    cell.style.background = '#ddd';
                    cell.onclick = () => toggleColorCell(cell);
                });
                document.getElementById('colorSubmit').style.display = 'block';
                gameArea.querySelector('.question').textContent = 'ğŸ¨ ìƒ‰ê¹”ì´ ìˆë˜ ì¹¸ì„ ì„ íƒí•˜ì„¸ìš”!';
            }, 2500);
        }

        function toggleColorCell(cell) {
            const index = cell.dataset.index;
            
            if (window.colorSelectedCells.includes(index)) {
                window.colorSelectedCells = window.colorSelectedCells.filter(i => i !== index);
                cell.style.background = '#ddd';
                cell.style.borderColor = 'transparent';
            } else {
                window.colorSelectedCells.push(index);
                cell.style.background = '#667eea';
                cell.style.borderColor = '#667eea';
                cell.style.boxShadow = '0 0 15px rgba(102, 126, 234, 0.5)';
            }
        }

        function checkColorMemory() {
            const correctAnswer = currentQuestion.answer;
            const userAnswer = window.colorSelectedCells.sort((a,b) => a-b).join(',');
            checkAnswer(userAnswer === correctAnswer, correctAnswer);
        }

        // 3. íŒ¨í„´ ì°¾ê¸°
        function generatePatternGame(diff) {
            const emojis = ['ğŸ¶', 'ğŸ±', 'ğŸ­', 'ğŸ¹', 'ğŸ°', 'ğŸ¦Š', 'ğŸ»', 'ğŸ¼', 'ğŸ¨', 'ğŸ¯', 'ğŸ¦', 'ğŸ®', 'ğŸ·', 'ğŸ¸'];
            const same = emojis[Math.floor(Math.random() * emojis.length)];
            const different = emojis.filter(e => e !== same)[Math.floor(Math.random() * (emojis.length - 1))];
            
            const items = [same, same, same, different].sort(() => Math.random() - 0.5);
            const correctIndex = items.indexOf(different);
            
            currentQuestion = { answer: correctIndex, type: 'pattern' };
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="question">ğŸ§© ë‹¤ë¥¸ ê²ƒì„ ì°¾ìœ¼ì„¸ìš”!</div>
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px; max-width: 300px;">
                    ${items.map((emoji, i) => `
                        <div style="width: 130px; height: 130px; background: white; border: 3px solid #667eea; border-radius: 15px; display: flex; align-items: center; justify-content: center; font-size: 4em; cursor: pointer; transition: all 0.3s;" onclick="checkAnswer(${i === correctIndex}, ${correctIndex})">${emoji}</div>
                    `).join('')}
                </div>
            `;
            
            if (selectedBooster === 'hint') {
                showNotification(`íŒíŠ¸: ${different} ì´ëª¨ì§€ê°€ ë‹¤ë¦…ë‹ˆë‹¤!`, 'info');
                gameData.boosters.hint--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
        }

        // 4. ë‹¨ì–´ ê²Œì„
        function generateWordGame(diff) {
            const wordLists = {
                easy: [
                    { scrambled: 'PELPA', answer: 'APPLE' },
                    { scrambled: 'RETAW', answer: 'WATER' },
                    { scrambled: 'KOLCC', answer: 'CLOCK' },
                    { scrambled: 'NPHOE', answer: 'PHONE' }
                ],
                medium: [
                    { scrambled: 'NOMKEY', answer: 'MONKEY' },
                    { scrambled: 'TEGRA', answer: 'GREAT' },
                    { scrambled: 'RIABN', answer: 'BRAIN' },
                    { scrambled: 'PHAYP', answer: 'HAPPY' }
                ],
                hard: [
                    { scrambled: 'NIQESTUO', answer: 'QUESTION' },
                    { scrambled: 'RUETPCOM', answer: 'COMPUTER' },
                    { scrambled: 'TANTIMROP', answer: 'IMPORTANT' }
                ]
            };
            
            let wordList = wordLists.easy;
            if (gameData.currentLevel > 30) wordList = wordLists.medium;
            if (gameData.currentLevel > 60) wordList = wordLists.hard;
            
            const selected = wordList[Math.floor(Math.random() * wordList.length)];
            currentQuestion = { answer: selected.answer, type: 'word' };
            
            const wrongAnswers = [
                selected.answer.split('').sort(() => Math.random() - 0.5).join('').substring(0, selected.answer.length),
                selected.answer.split('').reverse().join(''),
                selected.scrambled
            ].filter(w => w !== selected.answer).slice(0, 3);
            
            let answers = [selected.answer, ...wrongAnswers].sort(() => Math.random() - 0.5);
            
            // ë¶€ìŠ¤í„°: ì˜¤ë‹µ ì œê±°
            if (selectedBooster === 'bomb') {
                answers = [selected.answer, wrongAnswers[0]];
                gameData.boosters.bomb--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="question">ğŸ”¤ ë‹¨ì–´ë¥¼ ë§ì¶°ë³´ì„¸ìš”!</div>
                <div class="question" style="font-size: 2.5em; color: #667eea;">${selected.scrambled}</div>
                <div class="options">
                    ${answers.map(ans => `
                        <button class="option-btn" onclick="checkAnswer('${ans}' === '${selected.answer}', '${selected.answer}')">${ans}</button>
                    `).join('')}
                </div>
            `;
            
            if (selectedBooster === 'hint') {
                showNotification(`íŒíŠ¸: ì •ë‹µì€ ${selected.answer}ì…ë‹ˆë‹¤!`, 'info');
                gameData.boosters.hint--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
        }

        // 5. ë°˜ì‘ì†ë„ ê²Œì„
        function generateReactionGame(diff) {
            currentQuestion = { answer: 'reaction', type: 'reaction' };
            
            const gameArea = document.getElementById('gameArea');
            gameArea.innerHTML = `
                <div class="question">âš¡ ì´ˆë¡ìƒ‰ì´ ë˜ë©´ í´ë¦­!</div>
                <div id="reactionBox" style="width: 200px; height: 200px; background: #e74c3c; border-radius: 20px; cursor: pointer; display: flex; align-items: center; justify-content: center; font-size: 1.5em; color: white; font-weight: bold; transition: all 0.3s;">
                    ëŒ€ê¸°ì¤‘...
                </div>
            `;
            
            const box = document.getElementById('reactionBox');
            const delay = Math.random() * 2000 + 1500;
            
            setTimeout(() => {
                if (!box) return;
                box.style.background = '#2ecc71';
                box.textContent = 'í´ë¦­!';
                const startTime = Date.now();
                
                box.onclick = () => {
                    const reactionTime = Date.now() - startTime;
                    const maxTime = 1000 + (gameData.currentLevel * 10);
                    const isGood = reactionTime < maxTime;
                    
                    showNotification(`ë°˜ì‘ ì†ë„: ${reactionTime}ms`, isGood ? 'success' : 'error');
                    setTimeout(() => checkAnswer(isGood, reactionTime), 500);
                };
            }, delay);
            
            if (selectedBooster === 'hint') {
                showNotification(`íŒíŠ¸: ${Math.floor(delay/1000)}ì´ˆ í›„ì— ë°”ë€ë‹ˆë‹¤!`, 'info');
                gameData.boosters.hint--;
                selectedBooster = null;
                saveData();
                updateUI();
            }
        }

        // ê²Œì„ íƒ€ì´ë¨¸
        function startGameTimer() {
            updateTimerDisplay();
            
            // ì‹œê°„ ì •ì§€ ë¶€ìŠ¤í„°
            if (selectedBooster === 'freeze') {
                gameData.boosters.freeze--;
                selectedBooster = null;
                saveData();
                updateUI();
                showNotification('ì‹œê°„ì´ ì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤! (30ì´ˆ)', 'success');
                setTimeout(() => {
                    startActualTimer();
                }, 30000);
                return;
            }
            
            startActualTimer();
        }

        function startActualTimer() {
            gameTimer = setInterval(() => {
                timeLeft--;
                updateTimerDisplay();
                
                if (timeLeft <= 0) {
                    clearInterval(gameTimer);
                    levelFailed();
                }
            }, 1000);
        }

        function updateTimerDisplay() {
            document.getElementById('gameTimer').textContent = timeLeft;
        }

        // ì •ë‹µ í™•ì¸
        function checkAnswer(isCorrect, correctAnswerDisplay) {
            clearInterval(gameTimer);
            
            // ë°˜ì‘ì†ë„ ê²Œì„ì€ ë°”ë¡œ ì²˜ë¦¬
            if (currentQuestion.type === 'reaction') {
                setTimeout(() => {
                    if (isCorrect) {
                        levelCleared();
                    } else {
                        levelFailed();
                    }
                }, 500);
                return;
            }
            
            // ìƒ‰ê¹” ê¸°ì–µ ê²Œì„ì€ ë²„íŠ¼ ì—†ì´ ì²˜ë¦¬
            if (currentQuestion.type === 'color') {
                setTimeout(() => {
                    if (isCorrect) {
                        levelCleared();
                    } else {
                        levelFailed();
                    }
                }, 500);
                return;
            }
            
            const buttons = document.querySelectorAll('.option-btn');
            buttons.forEach(btn => {
                btn.disabled = true;
                const btnText = btn.textContent.trim();
                const correctText = correctAnswerDisplay !== undefined ? correctAnswerDisplay.toString() : currentQuestion.answer.toString();
                
                if (btnText === correctText) {
                    btn.classList.add('correct');
                } else if (!isCorrect) {
                    // ì‚¬ìš©ìê°€ í´ë¦­í•œ ë²„íŠ¼ë§Œ ì˜¤ë‹µ í‘œì‹œ
                    if (btn === event.target) {
                        btn.classList.add('wrong');
                    }
                }
            });
            
            setTimeout(() => {
                if (isCorrect) {
                    levelCleared();
                } else {
                    levelFailed();
                }
            }, 1000);
        }

        // ë ˆë²¨ í´ë¦¬ì–´
        function levelCleared() {
            const reward = Math.floor(gameData.currentLevel / 5) + 5;
            gameData.coins += reward;
            gameData.currentLevel++;
            if (gameData.currentLevel > gameData.highestLevel) {
                gameData.highestLevel = gameData.currentLevel;
            }
            
            saveData();
            updateUI();
            
            document.getElementById('resultIcon').textContent = 'ğŸ‰';
            document.getElementById('resultTitle').textContent = `ë ˆë²¨ ${gameData.currentLevel - 1} í´ë¦¬ì–´!`;
            document.getElementById('resultMessage').textContent = 'ë©‹ì ¸ìš”! ë‹¤ìŒ ë ˆë²¨ë¡œ ë„ì „í•˜ì„¸ìš”!';
            document.getElementById('rewardText').textContent = `+${reward} ğŸ’`;
            
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('resultModal').classList.add('show');
        }

        // ë ˆë²¨ ì‹¤íŒ¨
        function levelFailed() {
            let failMessage = '';
            
            if (currentQuestion.type === 'math') {
                failMessage = `ì •ë‹µì€ ${currentQuestion.answer}ì˜€ìŠµë‹ˆë‹¤`;
            } else if (currentQuestion.type === 'color') {
                failMessage = `ë‹¤ì‹œ ë„ì „í•´ë³´ì„¸ìš”!`;
            } else if (currentQuestion.type === 'pattern') {
                failMessage = `ë‹¤ì‹œ ì§‘ì¤‘í•´ì„œ ë„ì „í•´ë³´ì„¸ìš”!`;
            } else if (currentQuestion.type === 'word') {
                failMessage = `ì •ë‹µì€ ${currentQuestion.answer}ì˜€ìŠµë‹ˆë‹¤`;
            } else if (currentQuestion.type === 'reaction') {
                failMessage = `ë„ˆë¬´ ëŠ¦ì—ˆì–´ìš”! ë” ë¹¨ë¦¬ í´ë¦­í•˜ì„¸ìš”!`;
            }
            
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('failModal').classList.add('show');
            document.getElementById('failMessage').textContent = failMessage;
        }

        // ë‹¤ìŒ ë ˆë²¨
        function nextLevel() {
            document.getElementById('resultModal').classList.remove('show');
            startLevel();
        }

        // ê´‘ê³  ë³´ê³  ì¬ë„ì „
        function watchAdToContinue() {
            showNotification('ğŸ“º ê´‘ê³  ì‹œì²­ ì¤‘... (ì‹¤ì œ ì•±ì—ì„œëŠ” ê´‘ê³  í‘œì‹œ)', 'info');
            
            setTimeout(() => {
                document.getElementById('failModal').classList.remove('show');
                showNotification('ê´‘ê³  ì‹œì²­ ì™„ë£Œ! ì¬ë„ì „ ê¸°íšŒë¥¼ ì–»ì—ˆìŠµë‹ˆë‹¤!', 'success');
                startLevel();
            }, 2000);
        }

        // ì—ë„ˆì§€ë¡œ ì¬ë„ì „
        function useEnergyToRetry() {
            if (gameData.energy <= 0 && !gameData.isPremium) {
                showNotification('ì—ë„ˆì§€ê°€ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            if (!gameData.isPremium) {
                gameData.energy--;
                saveData();
                updateUI();
            }
            
            document.getElementById('failModal').classList.remove('show');
            startLevel();
        }

        // ì‹¤íŒ¨ ëª¨ë‹¬ ë‹«ê¸°
        function closeFailModal() {
            document.getElementById('failModal').classList.remove('show');
            backToMain();
        }

        // ë©”ì¸ìœ¼ë¡œ
        function backToMain() {
            clearInterval(gameTimer);
            gameTimer = null;
            document.getElementById('gameScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
            document.getElementById('resultModal').classList.remove('show');
            document.getElementById('failModal').classList.remove('show');
        }

        // ì—ë„ˆì§€ ë¶€ì¡± ëª¨ë‹¬
        function showNoEnergyModal() {
            document.getElementById('noEnergyModal').classList.add('show');
        }

        function closeNoEnergyModal() {
            document.getElementById('noEnergyModal').classList.remove('show');
        }

        function showEnergyOptions() {
            showNoEnergyModal();
        }

        function watchAdForEnergy() {
            showNotification('ğŸ“º ê´‘ê³  ì‹œì²­ ì¤‘...', 'info');
            
            setTimeout(() => {
                gameData.energy = Math.min(gameData.energy + 1, gameData.maxEnergy);
                gameData.lastEnergyTime = Date.now();
                saveData();
                updateUI();
                closeNoEnergyModal();
                showNotification('ì—ë„ˆì§€ 1ê°œ íšë“! â¤ï¸', 'success');
            }, 2000);
        }

        function buyEnergyFromModal() {
            if (gameData.coins < 50) {
                showNotification('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            gameData.coins -= 50;
            gameData.energy = gameData.maxEnergy;
            gameData.lastEnergyTime = Date.now();
            saveData();
            updateUI();
            closeNoEnergyModal();
            showNotification('ì—ë„ˆì§€ 5ê°œ ì¶©ì „ ì™„ë£Œ! â¤ï¸', 'success');
        }

        // ë¶€ìŠ¤í„° ì„ íƒ
        function selectBooster(type) {
            if (gameData.boosters[type] <= 0) {
                showNotification('ë¶€ìŠ¤í„°ê°€ ì—†ìŠµë‹ˆë‹¤! ìƒì ì—ì„œ êµ¬ë§¤í•˜ì„¸ìš”.', 'error');
                return;
            }
            
            selectedBooster = type;
            document.querySelectorAll('.booster-card').forEach(card => {
                card.classList.remove('active');
            });
            event.currentTarget.classList.add('active');
            
            const names = {
                time: 'ì‹œê°„ ì¶”ê°€',
                hint: 'íŒíŠ¸',
                bomb: 'ì˜¤ë‹µ ì œê±°',
                freeze: 'ì‹œê°„ ì •ì§€'
            };
            showNotification(`${names[type]} ë¶€ìŠ¤í„° ì¤€ë¹„ë¨!`, 'success');
        }

        // ìƒì 
        function showShop() {
            document.getElementById('mainScreen').style.display = 'none';
            document.getElementById('shopScreen').style.display = 'block';
        }

        function closeShop() {
            document.getElementById('shopScreen').style.display = 'none';
            document.getElementById('mainScreen').style.display = 'block';
        }

        function buyItem(item, cost) {
            if (gameData.coins < cost) {
                showNotification('ì½”ì¸ì´ ë¶€ì¡±í•©ë‹ˆë‹¤!', 'error');
                return;
            }
            
            gameData.coins -= cost;
            
            if (item === 'energy5') {
                gameData.energy = gameData.maxEnergy;
                gameData.lastEnergyTime = Date.now();
            } else if (item === 'time5') {
                gameData.boosters.time += 5;
            } else if (item === 'hint10') {
                gameData.boosters.hint += 10;
            } else if (item === 'bomb5') {
                gameData.boosters.bomb += 5;
            }
            
            saveData();
            updateUI();
            showNotification('êµ¬ë§¤ ì™„ë£Œ!', 'success');
        }

        function buyWithMoney(item, price) {
            showNotification(`ì‹¤ì œ ì•±ì—ì„œëŠ” $${price} ê²°ì œê°€ ì§„í–‰ë©ë‹ˆë‹¤. (ë°ëª¨ì—ì„œëŠ” ë¬´ë£Œ ì§€ê¸‰)`, 'info');
            
            if (item === 'unlimited1h') {
                showNotification('1ì‹œê°„ ë™ì•ˆ ë¬´ì œí•œ ì—ë„ˆì§€! (ë°ëª¨)', 'success');
            } else if (item === 'coins100') {
                gameData.coins += 100;
            } else if (item === 'coins500') {
                gameData.coins += 500;
            } else if (item === 'coins1500') {
                gameData.coins += 1500;
            }
            
            saveData();
            updateUI();
        }

        function buyPremium() {
            showNotification('ì‹¤ì œ ì•±ì—ì„œëŠ” $4.99/ì›” êµ¬ë…ì´ ì§„í–‰ë©ë‹ˆë‹¤. (ë°ëª¨ì—ì„œëŠ” ë¬´ë£Œ í™œì„±í™”)', 'info');
            gameData.isPremium = true;
            gameData.energy = gameData.maxEnergy;
            saveData();
            updateUI();
        }

        // ì•Œë¦¼
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const text = document.getElementById('notificationText');
            text.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        // ì´ˆê¸°í™”
        loadData();
    </script>
</body>
</html>